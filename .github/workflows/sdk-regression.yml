name: SDK Regression
on:
  pull_request:
    types: [opened]
  issue_comment:
    types: [created, edited] 
jobs:
  regression:
    name: Trigger SDK regression test
    runs-on: ubuntu-latest
    if: ${{ github.event.issue.pull_request && github.event.comment.body == 'RUN_REGRESSION' }}
    strategy:
      matrix:
        repo: 
          - percy-ember
          - percy-cypress
          - percy-puppeteer
          # - percy-storybook
          - percy-playwright
          - percy-testcafe
          - percy-nightwatch
          - percy-nightmare
          - percy-webdriverio
          - percy-protractor
          - percy-selenium-js
          - percy-selenium-dotnet
          - percy-selenium-java
          - gatsby-plugin-percy
    steps:
      - name: Trigger Workflow & Wait
        uses: convictional/trigger-workflow-and-wait@v1.6.5
        with:
          owner: percy
          repo: ${{ matrix.repo }}
          github_token: ${{ secrets.WORKFLOW_DISPATCH_ACTIONS_TOKEN }}
          workflow_file_name: test.yml
          ref: master
          client_payload: '{ "branch": "${{ github.event.pull_request.head.ref || github.ref_name }}"}'
          wait_interval: 15
